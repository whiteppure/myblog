<!DOCTYPE html>
<html lang="zh" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="whitepure" />
	
	
	
	<title>Springboot整合Redis ｜ whitepure</title>
	
    
    
    <meta name="description" content="" />
    

    
    
    <meta name="keywords" content="whitepure博客, whiteppure, whitepure" />
    

	
    
    <link rel="shortcut icon" href="https://whiteppure.github.io/myblog/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/highlight.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/toc.css" />

    
    
</head>

<body>
    
    
    









<div class="toc">

    <div class="page-header"><strong>- CATALOG -</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#redis%e4%bb%8b%e7%bb%8d">
                    Redis介绍
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#1%e5%af%bc%e5%85%a5%e4%be%9d%e8%b5%96">
                    1.导入依赖
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#2%e9%85%8d%e7%bd%aeredis">
                    2.配置redis
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#3%e7%bc%93%e5%ad%98%e6%b3%a8%e8%a7%a3%e4%bb%8b%e7%bb%8d">
                    3.缓存注解介绍
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#4%e6%b5%8b%e8%af%95">
                    4.测试
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        

    </div>

</div>



    
    <div class="main animate__animated animate__fadeInDown" id="pdf_content">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul><li class="">
                <a href="https://whiteppure.github.io/myblog/">首页</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/posts/">归档</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/tags/">标签</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/about/">关于</a>
            </li>
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://whiteppure.github.io/myblog/" style="width: 100%">
                    <span>whitepure</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">简单是一种隐藏的极致</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/whiteppure/" title="github" target="_blank">
                    <i class="ri-github-fill"></i>
                </a>
                
                
                <a href="https://whiteppure.github.io/myblog/index.xml" type="application/rss+xml" title="rss" target="_blank">
                    <i class="ri-rss-fill"></i>
                </a>
                <button id="export_pdf" style="border: none; background-color: #ffffff; cursor: pointer; margin-left: 4px">
                    <svg t="1614337230032" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2940" width="10" height="10"><path d="M825.202759 488.292634L584.527448 244.926676v484.916965c0 40.197297-32.584386 72.774621-72.781682 72.774621-40.190234 0-72.767559-32.577324-72.767559-72.774621V245.654069L197.999228 490.404193c-27.68331 28.29771-73.071228 28.784993-101.368938 1.094621a74.526014 74.526014 0 0 1-1.094621-105.168331L454.182841 22.076028a70.182841 70.182841 0 0 1 63.8976-19.067587 70.8608 70.8608 0 0 1 52.111007 21.179145l356.973462 360.977655c28.156469 28.608441 28.156469 74.518952 0 103.127393-27.662124 28.156469-72.915862 28.559007-101.065269 0.896883a53.699972 53.699972 0 0 1-0.896882-0.896883m123.211917 532.663614H75.083917c-40.190234 0-72.774621-32.584386-72.77462-72.781682v-145.556304c0-40.197297 32.59851-72.767559 72.788744-72.760496 40.183172 0.007062 72.753434 32.577324 72.767559 72.760496v72.774621h727.774455v-72.774621c0-40.197297 32.584386-72.774621 72.774621-72.774621 40.197297 0 72.774621 32.577324 72.774621 72.774621v145.556304c0 40.197297-32.577324 72.781683-72.774621 72.781682" fill="#707070" p-id="2941"></path></svg>
                </button>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/myblog/posts/application/springboot-redis/'>Springboot整合Redis</a></h2>
                        <span class="date">2020.03.01</span>
                    </div>
                    <div class="post_content markdown"><h3 id="redis介绍">Redis介绍</h3>
<p><strong>Redis 可以存储键与5种不同数据结构类型之间的映射，这5种数据结构类型分别为String（字符串）、List（列表）、Set（集合）、Hash（散列）和 Zset(有序集合)</strong></p>
<p><strong>String</strong> 可以是字符串、整数或者浮点数 对整个字符串或者字符串的其中一部分执行操作；对象和浮点数执行自增(increment)或者自减(decrement)
List 一个链表，链表上的每个节点都包含了一个字符串 从链表的两端推入或者弹出元素；根据偏移量对链表进行修剪(trim)；读取单个或者多个元素；根据值来查找或者移除元素
<strong>Set</strong> 包含字符串的无序收集器(unorderedcollection)，并且被包含的每个字符串都是独一无二的、各不相同 添加、获取、移除单个元素；检查一个元素是否存在于某个集合中；计算交集、并集、差集；从集合里卖弄随机获取元素
<strong>Hash</strong> 包含键值对的无序散列表 添加、获取、移除单个键值对；获取所有键值对
<strong>Zset</strong> 字符串成员(member)与浮点数分值(score)之间的有序映射，元素的排列顺序由分值的大小决定 添加、获取、删除单个元素；根据分值范围(range)或者成员来获取元素
<strong>注意: Java bean 要序列化</strong></p>
<h3 id="1导入依赖">1.导入依赖</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//gradle
</span><span style="color:#75715e"></span>compile group<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> name<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>data<span style="color:#f92672">-</span>redis<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> version<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">3</span><span style="color:#f92672">.</span><span style="color:#a6e22e">RELEASE</span><span style="color:#960050;background-color:#1e0010">&#39;</span>

<span style="color:#75715e">//pom
</span><span style="color:#75715e"></span><span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>data<span style="color:#f92672">-</span>redis<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">3</span><span style="color:#f92672">.</span><span style="color:#a6e22e">RELEASE</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><h3 id="2配置redis">2.配置redis</h3>
<p>redis.config</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisConfig</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">//用于解决注解操作redis 序列话的问题
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myCacheManager&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> CacheManager <span style="color:#a6e22e">cacheManager</span><span style="color:#f92672">(</span>RedisConnectionFactory redisConnectionFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        RedisCacheWriter redisCacheWriter <span style="color:#f92672">=</span> RedisCacheWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">nonLockingRedisCacheWriter</span><span style="color:#f92672">(</span>redisConnectionFactory<span style="color:#f92672">);</span>
        RedisSerializer<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> jsonSerializer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> GenericJackson2JsonRedisSerializer<span style="color:#f92672">();</span>
        RedisSerializationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">SerializationPair</span><span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> pair <span style="color:#f92672">=</span> RedisSerializationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">SerializationPair</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">fromSerializer</span><span style="color:#f92672">(</span>jsonSerializer<span style="color:#f92672">);</span>
        RedisCacheConfiguration defaultCacheConfig<span style="color:#f92672">=</span> RedisCacheConfiguration<span style="color:#f92672">.</span><span style="color:#a6e22e">defaultCacheConfig</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">serializeValuesWith</span><span style="color:#f92672">(</span>pair<span style="color:#f92672">);</span>
        defaultCacheConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">entryTtl</span><span style="color:#f92672">(</span>Duration<span style="color:#f92672">.</span><span style="color:#a6e22e">ofMinutes</span><span style="color:#f92672">(</span>30<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> RedisCacheManager<span style="color:#f92672">(</span>redisCacheWriter<span style="color:#f92672">,</span> defaultCacheConfig<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">/**
</span><span style="color:#75715e"> * 解决用redisTemplate操作的序列化的问题
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param factory RedisConnectionFactory
</span><span style="color:#75715e"> * @return redisTemplate
</span><span style="color:#75715e"> */</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#a6e22e">@ConditionalOnMissingBean</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;redisTemplate&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">redisTemplate</span><span style="color:#f92672">(</span>RedisConnectionFactory factory<span style="color:#f92672">){</span>
        <span style="color:#75715e">// 配置redisTemplate
</span><span style="color:#75715e"></span>        RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> redisTemplate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RedisTemplate<span style="color:#f92672">&lt;&gt;();</span>
        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectionFactory</span><span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
        <span style="color:#75715e">// key序列化
</span><span style="color:#75715e"></span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setKeySerializer</span><span style="color:#f92672">(</span>STRING_SERIALIZER<span style="color:#f92672">);</span>
        <span style="color:#75715e">// value序列化
</span><span style="color:#75715e"></span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setValueSerializer</span><span style="color:#f92672">(</span>JACKSON__SERIALIZER<span style="color:#f92672">);</span>
        <span style="color:#75715e">// Hash key序列化
</span><span style="color:#75715e"></span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashKeySerializer</span><span style="color:#f92672">(</span>STRING_SERIALIZER<span style="color:#f92672">);</span>
        <span style="color:#75715e">// Hash value序列化
</span><span style="color:#75715e"></span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashValueSerializer</span><span style="color:#f92672">(</span>JACKSON__SERIALIZER<span style="color:#f92672">);</span>
        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">afterPropertiesSet</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>启动类配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@EnableCaching</span>  <span style="color:#75715e">//允许注解操作缓存
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisExampleApplication</span> <span style="color:#f92672">{</span>
   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>RedisExampleApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>application.yml 配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e">#redis 缓存配置</span>
<span style="color:#f92672">redis</span>:
  <span style="color:#f92672">database</span>: <span style="color:#ae81ff">0</span>
  <span style="color:#f92672">host</span>: @<span style="color:#ae81ff">ip</span>
  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
  <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">8000</span>
  <span style="color:#75715e">#如果没有可不写</span>
  <span style="color:#f92672">password</span>:
  <span style="color:#f92672">jedis</span>:
    <span style="color:#f92672">pool</span>:
      <span style="color:#75715e">#连接池最大连接数量</span>
      <span style="color:#f92672">max-active</span>: <span style="color:#ae81ff">10</span>
      <span style="color:#75715e">#连接池最大堵塞时间</span>
      <span style="color:#f92672">max-wait</span>: -<span style="color:#ae81ff">1</span>
      <span style="color:#75715e">#连接池最小空闲连接</span>
      <span style="color:#f92672">min-idle</span>: <span style="color:#ae81ff">0</span>
      <span style="color:#75715e">#连接池最大空闲连接</span>
      <span style="color:#f92672">max-idle</span>: <span style="color:#ae81ff">8</span>
</code></pre></div><h3 id="3缓存注解介绍">3.缓存注解介绍</h3>
<p><code>@Cacheable</code>作用将方法的运行结果进行缓存,以后要相同的数据,直接从缓存中获取.
cacheNames 和 key 都必须填，如果不填 key ，默认的 key 是当前的方法名，更新缓存时会因为方法名不同而更新失败.</p>
<ul>
<li>value:   指定缓存名称 可指定多个(数组)</li>
<li>key:  缓存数据使用的key默认为方法参数支持 spEL</li>
<li>keyGenerator:  key的生成器</li>
<li>CacheManager:  指定缓存管理器,或获取解析器,两者二选一</li>
<li>condition:  指定条件缓存</li>
<li>unless:  否定缓存. 当unless条件为true时,返回值就不会被缓存,可获取到结果判断</li>
<li>sync:  是否异步, 不支持unless</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">,</span> key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><p>既调用方法有更新缓存修改了数据库某个数据.同时更新缓存,先调用目标方法将目标方法缓存起来,更新时要注意,要和查询时的key相同,否则缓存不会更新,属性和 @Cacheable 相同</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@CachePut</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">,</span> key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><p>删除缓存
allEntries:是否删除所有字段的缓存
beforeInvocation:是否在方法之前执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@CacheEvict</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">,</span> key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><p><code>@CacheConfig </code>可指定公共key的生成策略</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 公共的cacheNames (value) 可以统一写在类上面 遮掩就不用每缓存一个就起名字了
</span><span style="color:#75715e">// 公共的CacheManager
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@CacheConfig</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisExampleController</span> <span style="color:#f92672">{</span>
  
    <span style="color:#a6e22e">@Caching</span><span style="color:#f92672">(</span>cacheable <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">},</span> put <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@CachePut</span><span style="color:#f92672">})</span>
    <span style="color:#66d9ef">public</span> Response<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(){</span>
          <span style="color:#75715e">//to do
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Key 也可以动态设置为方法的参数(支持EL)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">,</span> key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#openid&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> Response <span style="color:#a6e22e">detail</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;openid&#34;</span><span style="color:#f92672">)</span> String openid<span style="color:#f92672">){</span>
      <span style="color:#75715e">//to do sthing
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>复合注解</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 查询数据时 先去更新数据 在放到缓存中
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@Caching</span><span style="color:#f92672">(</span>cacheable <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">},</span> put <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@CachePut</span><span style="color:#f92672">})</span>
<span style="color:#a6e22e">@Caching</span><span style="color:#f92672">(</span>cacheable <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">},</span> put <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@CachePut</span><span style="color:#f92672">},</span> evict <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@CacheEvict</span><span style="color:#f92672">})</span>
</code></pre></div><h3 id="4测试">4.测试</h3>
<p>注解版:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//自定义名称
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@CacheConfig</span><span style="color:#f92672">(</span>cacheNames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xxx&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductInfoController</span> <span style="color:#f92672">{</span>   
    <span style="color:#75715e">//简单用法 
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Caching</span><span style="color:#f92672">(</span>cacheable <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@Cacheable</span><span style="color:#f92672">},</span> put <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#a6e22e">@CachePut</span><span style="color:#f92672">})</span>
    <span style="color:#66d9ef">public</span> Response<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">getById</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span> Integer id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">//to do sthing
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Redistemplate版:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Autowired</span>
<span style="color:#66d9ef">private</span> RedisTemplate redisTemplate<span style="color:#f92672">;</span>

 <span style="color:#a6e22e">@Test</span> 
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">demo</span><span style="color:#f92672">(){</span>

    <span style="color:#75715e">//常见redis类型数据操作 set zset 未列出
</span><span style="color:#75715e"></span>        
    <span style="color:#75715e">//string 类型数据
</span><span style="color:#75715e"></span>    redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;123&#34;</span><span style="color:#f92672">);</span>
    redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// 输出结果为123
</span><span style="color:#75715e"></span>    
   <span style="color:#75715e">//list 数据类型
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPushAll</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;list&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]{</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">});</span><span style="color:#75715e">//从右边插入元素
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">range</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;list&#34;</span><span style="color:#f92672">,</span>0<span style="color:#f92672">,-</span>1<span style="color:#f92672">);</span><span style="color:#75715e">//获取所有元素
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">index</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;listRight&#34;</span><span style="color:#f92672">,</span>1<span style="color:#f92672">);</span><span style="color:#75715e">//获取下标为2的元素
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPush</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;listRiht&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//从右边插入 也可从左边插
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPop</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;list&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//从左边弹出元素 元素弹出将不存在
</span><span style="color:#75715e"></span>
   <span style="color:#75715e">//hash
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisHash&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;111&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//判断该hash key 是否存在
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisHash&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;111&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//存放 hash 数据
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">keys</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisHash&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//获取该key对应的hash值
</span><span style="color:#75715e"></span>   redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisHash&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;age&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//给定key 获取 hash 值
</span><span style="color:#75715e"></span> 
 
<span style="color:#f92672">}</span>
</code></pre></div></div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://whiteppure.github.io/myblog/tags/springboot/">springboot</a>
                                    
                                    <a href="https://whiteppure.github.io/myblog/tags/redis/">redis</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                <div class="doc_comments"></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>whitepure@2021</span>
    </div>
</footer>
    <script src="https://whiteppure.github.io/myblog/js/jquery-3.5.1.min.js"></script>
<link href="https://whiteppure.github.io/myblog/css/fancybox.min.css" rel="stylesheet">
<script src="https://whiteppure.github.io/myblog/js/fancybox.min.js"></script>
<script src="https://whiteppure.github.io/myblog/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>




<script src="https://cdn.bootcdn.net/ajax/libs/jspdf/1.0.106/jspdf.debug.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>

<script type="text/javascript">
    var downPdf = document.getElementById("export_pdf");
    var pdfContent = document.getElementById('pdf_content');
    downPdf.onclick = () => {
        html2canvas(pdfContent, {
            onrendered:function(canvas) {

                var contentWidth = canvas.width;
                var contentHeight = canvas.height;

                
                var pageHeight = contentWidth / 592.28 * 841.89;
                
                var leftHeight = contentHeight;
                
                var position = 0;
                
                
                

                var imgWidth = 595.28;
                var imgHeight = 585.28/contentWidth * contentHeight;

                var pageData = canvas.toDataURL('image/jpeg', 1.0);

                var pdf = new jsPDF('', 'pt', 'a4');

                
                

                
                
                if (leftHeight < pageHeight) {
                    pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
                } else {
                    while(leftHeight > 0) {
                        pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
                        leftHeight -= pageHeight;
                        position -= 841.89;
                        
                        if(leftHeight > 0) {
                            pdf.addPage();
                        }
                    }
                }

                pdf.save('whitepure_blog.pdf');
            }
        })
    }
</script>
</body>

</html>