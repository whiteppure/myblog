<!DOCTYPE html>
<html lang="zh" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="whitepure" />
	
	
	
	<title>Springboot整合redis ｜ whitepure</title>
	
    
    
    <meta name="description" content="" />
    

    
    
    <meta name="keywords" content="whitepure博客, whiteppure, whitepure" />
    

	
    
    <link rel="shortcut icon" href="https://whiteppure.github.io/myblog/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/highlight.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/myblog/css/toc.css" />

    
    
</head>

<body>
    
    
    









<div class="toc">

    <div class="page-header"><strong>- CATALOG -</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#redis%e4%bb%8b%e7%bb%8d">
                    Redis介绍
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e4%b8%bb%e8%a6%81%e7%89%b9%e7%82%b9">
                    主要特点
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#redis%e4%bc%98%e7%82%b9">
                    Redis优点
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e5%af%bc%e5%85%a5%e4%be%9d%e8%b5%96">
                    导入依赖
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e9%85%8d%e7%bd%aeredis">
                    配置redis
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#redisconfigclass">
                    RedisConfig.class
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e5%90%af%e5%8a%a8%e7%b1%bb%e9%85%8d%e7%bd%ae">
                    启动类配置
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#applicationyml-%e9%85%8d%e7%bd%ae">
                    application.yml 配置
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e7%bc%93%e5%ad%98%e6%b3%a8%e8%a7%a3%e4%bb%8b%e7%bb%8d">
                    缓存注解介绍
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#cacheable">
                    @Cacheable
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#cacheput">
                    @CachePut
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#cacheevict">
                    @CacheEvict
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#cacheconfig">
                    @CacheConfig
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e5%a4%8d%e5%90%88%e6%b3%a8%e8%a7%a3">
                    复合注解
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%b5%8b%e8%af%95">
                    测试
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        

    </div>

</div>



    
    <div class="main animate__animated animate__fadeInDown" id="pdf_content">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul><li class="">
                <a href="https://whiteppure.github.io/myblog/">首页</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/posts/">归档</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/tags/">标签</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/myblog/about/">关于</a>
            </li>
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://whiteppure.github.io/myblog/" style="width: 100%">
                    <span>whitepure</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">大道至简</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/whiteppure/" title="github" target="_blank">
                    <i class="ri-github-fill"></i>
                </a>
                
                
                <a href="https://whiteppure.github.io/myblog/index.xml" type="application/rss+xml" title="rss" target="_blank">
                    <i class="ri-rss-fill"></i>
                </a>
                <button id="export_pdf" style="border: none; background-color: #ffffff; cursor: pointer; margin-left: 4px">
                    <svg t="1614337230032" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2940" width="10" height="10"><path d="M825.202759 488.292634L584.527448 244.926676v484.916965c0 40.197297-32.584386 72.774621-72.781682 72.774621-40.190234 0-72.767559-32.577324-72.767559-72.774621V245.654069L197.999228 490.404193c-27.68331 28.29771-73.071228 28.784993-101.368938 1.094621a74.526014 74.526014 0 0 1-1.094621-105.168331L454.182841 22.076028a70.182841 70.182841 0 0 1 63.8976-19.067587 70.8608 70.8608 0 0 1 52.111007 21.179145l356.973462 360.977655c28.156469 28.608441 28.156469 74.518952 0 103.127393-27.662124 28.156469-72.915862 28.559007-101.065269 0.896883a53.699972 53.699972 0 0 1-0.896882-0.896883m123.211917 532.663614H75.083917c-40.190234 0-72.774621-32.584386-72.77462-72.781682v-145.556304c0-40.197297 32.59851-72.767559 72.788744-72.760496 40.183172 0.007062 72.753434 32.577324 72.767559 72.760496v72.774621h727.774455v-72.774621c0-40.197297 32.584386-72.774621 72.774621-72.774621 40.197297 0 72.774621 32.577324 72.774621 72.774621v145.556304c0 40.197297-32.577324 72.781683-72.774621 72.781682" fill="#707070" p-id="2941"></path></svg>
                </button>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/myblog/posts/spring/springboot-redis/'>Springboot整合redis</a></h2>
                        <span class="date">2020.03.01</span>
                    </div>
                    <div class="post_content markdown"><h2 id="redis介绍">Redis介绍</h2>
<p>redis是开源的一个高性能的 key-value 数据库。</p>
<h3 id="主要特点">主要特点</h3>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份</li>
<li>Redis 可以存储键与5种不同数据结构类型之间的映射
<ul>
<li><strong>String</strong> 可以是字符串、整数或者浮点数 对整个字符串或者字符串的其中一部分执行操作；对象和浮点数执行自增(increment)或者自减(decrement)</li>
<li><strong>List</strong> 一个链表，链表上的每个节点都包含了一个字符串 从链表的两端推入或者弹出元素；根据偏移量对链表进行修剪(trim)；读取单个或者多个元素；根据值来查找或者移除元素</li>
<li><strong>Set</strong> 包含字符串的无序收集器(unorderedcollection)，并且被包含的每个字符串都是独一无二的、各不相同 添加、获取、移除单个元素；检查一个元素是否存在于某个集合中；计算交集、并集、差集；从集合里卖弄随机获取元素</li>
<li><strong>Hash</strong> 包含键值对的无序散列表 添加、获取、移除单个键值对；获取所有键值对</li>
<li><strong>Zset</strong> 字符串成员(member)与浮点数分值(score)之间的有序映射，元素的排列顺序由分值的大小决定 添加、获取、删除单个元素；根据分值范围(range)或者成员来获取元素</li>
</ul>
</li>
</ul>
<p><strong>注意: Java bean 要序列化</strong></p>
<h3 id="redis优点">Redis优点</h3>
<ul>
<li>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li>
<li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li>
</ul>
<p>参考<a href="https://www.runoob.com/redis/redis-intro.html">菜鸟教程</a></p>
<h2 id="导入依赖">导入依赖</h2>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h2 id="配置redis">配置redis</h2>
<h3 id="redisconfigclass">RedisConfig.class</h3>
<pre><code>@Configuration
public class RedisConfig {

    //用于解决注解操作redis 序列话的问题
    @Bean(name = &quot;myCacheManager&quot;)
    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {

        RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);
        RedisSerializer&lt;Object&gt; jsonSerializer = new GenericJackson2JsonRedisSerializer();
        RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair
                .fromSerializer(jsonSerializer);
        RedisCacheConfiguration defaultCacheConfig= RedisCacheConfiguration.defaultCacheConfig()
                .serializeValuesWith(pair);
        defaultCacheConfig.entryTtl(Duration.ofMinutes(30));
        return new RedisCacheManager(redisCacheWriter, defaultCacheConfig);
    }
</code></pre><pre><code>    /**
 * 解决用redisTemplate操作的序列化的问题
 *
 * @param factory RedisConnectionFactory
 * @return redisTemplate
 */
    @Bean
    @ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)
    public RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory factory){
        // 配置redisTemplate
        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();
        redisTemplate.setConnectionFactory(factory);
        // key序列化
        redisTemplate.setKeySerializer(STRING_SERIALIZER);
        // value序列化
        redisTemplate.setValueSerializer(JACKSON__SERIALIZER);
        // Hash key序列化
        redisTemplate.setHashKeySerializer(STRING_SERIALIZER);
        // Hash value序列化
        redisTemplate.setHashValueSerializer(JACKSON__SERIALIZER);
        redisTemplate.afterPropertiesSet();
        return redisTemplate;
    }

}
</code></pre><h3 id="启动类配置">启动类配置</h3>
<pre><code>@EnableCaching  //允许注解操作缓存
@SpringBootApplication
public class RedisExampleApplication {
   public static void main(String[] args) {
      SpringApplication.run(RedisExampleApplication.class, args);
   }
}
</code></pre><h3 id="applicationyml-配置">application.yml 配置</h3>
<pre><code>#redis 缓存配置
redis:
  database: 0
  host: @ip
  port: 6379
  timeout: 8000
  #如果没有可不写
  password:
  jedis:
    pool:
      #连接池最大连接数量
      max-active: 10
      #连接池最大堵塞时间
      max-wait: -1
      #连接池最小空闲连接
      min-idle: 0
      #连接池最大空闲连接
      max-idle: 8
</code></pre><h2 id="缓存注解介绍">缓存注解介绍</h2>
<h3 id="cacheable">@Cacheable</h3>
<p><code>@Cacheable</code>作用将方法的运行结果进行缓存,以后要相同的数据,直接从缓存中获取.
cacheNames 和 key 都必须填，如果不填 key ，默认的 key 是当前的方法名，更新缓存时会因为方法名不同而更新失败.</p>
<p>属性</p>
<ul>
<li>value:   指定缓存名称 可指定多个(数组)</li>
<li>key:  缓存数据使用的key默认为方法参数支持 spEL</li>
<li>keyGenerator:  key的生成器</li>
<li>CacheManager:  指定缓存管理器,或获取解析器,两者二选一</li>
<li>condition:  指定条件缓存</li>
<li>unless:  否定缓存. 当unless条件为true时,返回值就不会被缓存,可获取到结果判断</li>
<li>sync:  是否异步, 不支持unless</li>
</ul>
<p>key 也可以动态设置为方法的参数(支持EL)</p>
<pre><code>@Cacheable(cacheNames = &quot;xxx&quot;, key = &quot;#openid&quot;)
public Response detail(@RequestParam(&quot;openid&quot;) String openid){
      //to do sthing
}
</code></pre><pre><code>@Cacheable(cacheNames = &quot;xxx&quot;, key = &quot;xxx&quot;,keyGenerator = &quot;xxx&quot;, CacheManager = &quot;xxx&quot;, condition = &quot;xxx&quot;, unless = &quot;xxx&quot;, sync = &quot;xxx&quot;)
</code></pre><h3 id="cacheput">@CachePut</h3>
<p>既调用方法又更新缓存修改了数据库某个数据.
更新缓存,先调用目标方法将目标方法缓存起来,更新时要注意,要和查询时的key相同,否则缓存不会更新,属性和 @Cacheable 相同</p>
<pre><code>@CachePut(cacheNames = &quot;xxx&quot;, key = &quot;xxx&quot;,keyGenerator = &quot;xxx&quot;, CacheManager = &quot;xxx&quot;, condition = &quot;xxx&quot;, unless = &quot;xxx&quot;, sync = &quot;xxx&quot;)
</code></pre><h3 id="cacheevict">@CacheEvict</h3>
<p>该注解作用是删除缓存，需要指定 key</p>
<ul>
<li>allEntries:是否删除所有字段的缓存</li>
<li>beforeInvocation:是否在方法之前执行</li>
</ul>
<pre><code>@CacheEvict(cacheNames = &quot;xxx&quot;, key = &quot;xxx&quot;, allEntries = &quot;xxx&quot;, beforeInvocation=&quot;xxx&quot;)
</code></pre><h3 id="cacheconfig">@CacheConfig</h3>
<p><code>@CacheConfig </code>可指定公共key的生成策略</p>
<pre><code>// 公共的cacheNames (value) 可以统一写在类上面 这样就不用每缓存一个就起名字了
// 公共的CacheManager
@CacheConfig(cacheNames = &quot;xxx&quot;)
public class RedisExampleController {
  
    @Caching(cacheable = {@Cacheable}, put = {@CachePut})
    public Response&lt;Map&lt;String, Object&gt;&gt; test(){
          //to do
    }
}
</code></pre><h3 id="复合注解">复合注解</h3>
<pre><code>// 查询数据时 先去更新数据 在放到缓存中
@Caching(cacheable = {@Cacheable}, put = {@CachePut})
@Caching(cacheable = {@Cacheable}, put = {@CachePut}, evict = {@CacheEvict})
</code></pre><h2 id="测试">测试</h2>
<pre><code>@Autowired
private RedisTemplate redisTemplate;

 @Test 
public void demo(){

    //常见redis类型数据操作 set zset 未列出
        
    //string 类型数据
    redisTemplate.opsForValue().set(&quot;test&quot;,&quot;123&quot;);
    redisTemplate.opsForValue().get(&quot;test&quot;) // 输出结果为123
    
   //list 数据类型
   redisTemplate.opsForList().rightPushAll(&quot;list&quot;,new String[]{&quot;1&quot;,&quot;2&quot;,&quot;3&quot;});//从右边插入元素
   redisTemplate.opsForList().range(&quot;list&quot;,0,-1);//获取所有元素
   redisTemplate.opsForList().index(&quot;listRight&quot;,1);//获取下标为2的元素
   redisTemplate.opsForList().rightPush(&quot;listRiht&quot;,&quot;1&quot;);//从右边插入 也可从左边插
   redisTemplate.opsForList().leftPop(&quot;list&quot;);//从左边弹出元素 元素弹出将不存在

   //hash
   redisTemplate.opsForHash().hasKey(&quot;redisHash&quot;,&quot;111&quot;);//判断该hash key 是否存在
   redisTemplate.opsForHash().put(&quot;redisHash&quot;,&quot;name&quot;,&quot;111&quot;);//存放 hash 数据
   redisTemplate.opsForHash().keys(&quot;redisHash&quot;);//获取该key对应的hash值
   redisTemplate.opsForHash().get(&quot;redisHash&quot;,&quot;age&quot;);//给定key 获取 hash 值
 
 
}
</code></pre></div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://whiteppure.github.io/myblog/tags/springboot/">springboot</a>
                                    
                                    <a href="https://whiteppure.github.io/myblog/tags/redis/">redis</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                <div class="doc_comments"></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>whitepure@2021</span>
    </div>
</footer>
    <script src="https://whiteppure.github.io/myblog/js/jquery-3.5.1.min.js"></script>
<link href="https://whiteppure.github.io/myblog/css/fancybox.min.css" rel="stylesheet">
<script src="https://whiteppure.github.io/myblog/js/fancybox.min.js"></script>
<script src="https://whiteppure.github.io/myblog/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>




<script src="https://cdn.bootcdn.net/ajax/libs/jspdf/1.0.106/jspdf.debug.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>

<script type="text/javascript">
    var downPdf = document.getElementById("export_pdf");
    var pdfContent = document.getElementById('pdf_content');
    downPdf.onclick = () => {
        html2canvas(pdfContent, {
            onrendered:function(canvas) {

                var contentWidth = canvas.width;
                var contentHeight = canvas.height;

                
                var pageHeight = contentWidth / 592.28 * 841.89;
                
                var leftHeight = contentHeight;
                
                var position = 0;
                
                
                

                var imgWidth = 595.28;
                var imgHeight = 585.28/contentWidth * contentHeight;

                var pageData = canvas.toDataURL('image/jpeg', 1.0);

                var pdf = new jsPDF('', 'pt', 'a4');

                
                

                
                
                if (leftHeight < pageHeight) {
                    pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
                } else {
                    while(leftHeight > 0) {
                        pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
                        leftHeight -= pageHeight;
                        position -= 841.89;
                        
                        if(leftHeight > 0) {
                            pdf.addPage();
                        }
                    }
                }

                pdf.save('whitepure_blog.pdf');
            }
        })
    }
</script>
</body>

</html>